@using Mari.Contracts.Releases
@using System.Data
@inject HttpClient Client
<!-- карта создания релиза -->
 


<!-- TODO: Кликабельный фон --> 

<MudPaper Class="paper-edit-release" Elevation="0">
    <MudCard Class="border card-create-release">

        <MudForm Model="@EditRelease">
            <MudCardActions Class="pb-0">
                <!-- TODO доделать OnClick -->
                <MudIconButton Class="ml-auto" OnClick="ClickOnEditingRelease" Icon="@Icons.Filled.Close" />
            </MudCardActions>

            <MudCardContent Class="pt-0">
                
                <MudDatePicker @bind-Date="EditDateForRelease" @ref="DatePicker"  Label="Дата Завершения">
                    <PickerActions>
                        <MudButton Class="mr-auto align-self-start" OnClick="@(() => DatePicker.Clear())">Clear</MudButton>
                        <MudButton OnClick="@(() => DatePicker.Close(false))">Cancel</MudButton>
                        <MudButton Color="Color.Primary" OnClick="@(() => DatePicker.Close())">Ok</MudButton>
                    </PickerActions>
                </MudDatePicker>
                
                <MudTextField @bind-Value="EditRelease.PlatformName"   Immediate="true" Label="Платформа" />

                <MudTextField @bind-Value="EditRelease.Version"   Immediate="true" Label="Версия" />
                
                <MudTextField @bind-Value="EditRelease.Status"   Immediate="true" Label="Статус" /> <!-- TODO только для релиз-менеджера -->

                <MudTextField @bind-Value="EditRelease.ReleaseTask"   Immediate="true"
                              Label="Ссылка на релиз задачу" />

                <MudTextField @bind-Value="EditRelease.Information"  Immediate="true"
                    Variant="Variant.Filled" Lines="5" Label="Информация" />

            </MudCardContent>

            <MudCardActions>
                <!-- TODO доделать OnClick -->
                <MudButton OnClick="ClickOnEditRelease" Variant="Variant.Filled" Color="Color.Primary"
                    Class="mx-auto">Добавить</MudButton>
            </MudCardActions>
        </MudForm>

    </MudCard>
</MudPaper>


@code {
	
	[Parameter]
	public Action ClickOnEditingRelease { get; set; } = () => { };

    [Parameter]
    public ReleaseAnswer Release { get; set;  }
    
    public ReleaseEditPostRequest EditRelease { get; set; }
    public DateTime? EditDateForRelease { get; set; } = new DateTime(); 
    
	MudDatePicker DatePicker;

    protected override async Task OnInitializedAsync()
    {
        
        EditRelease = new ReleaseEditPostRequest(
            Release.ReleaseId,
            Release.Version,
            Release.PlatformName,
            Release.Status,
            Release.ReleaseTask,
            Release.CompleteDate,
            Release.Information
            );
    }
    
    public async Task ClickOnEditRelease()
    {
        EditRelease.CompleteDate = EditDateForRelease;
        
      //  Client.PostAsJsonAsync<ReleaseEditPostRequest>(Routes.Server.ReleaseController, EditRelease);
        ClickOnEditingRelease(); 
    }
    
}